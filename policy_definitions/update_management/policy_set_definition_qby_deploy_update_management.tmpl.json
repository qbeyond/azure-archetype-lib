{
    "name": "QBY-Deploy-Update-Mgmt",
    "type": "Microsoft.Authorization/policySetDefinitions",
    "apiVersion": "2021-06-01",
    "scope": null,
    "properties": {
        "policyType": "Custom",
        "displayName": "Deploy Update Management Resources",
        "description": "This policy set deploys maintenance configuration and configuration assignments based on the tag 'Severity Group Monthly'. It also changes the VM patch mode to AutomaticByPlatform, if necessary.",
        "metadata": {
            "version": "1.0.0",
            "category": "Azure Update Manager"
        },
        "parameters": {},
        "policyDefinitions": [
                    {
                        "policyDefinitionReferenceId": "Configure update management for virtual machines with a given tag using Azure Update Manager",
                        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/QBY-Deploy-Updates",
                        "parameters": {
                            "managementSubscriptionId": {
                                "value": "00000000-0000-0000-0000-000000000000"
                            },
                            "managementResourceGroup": {
                                "value": "rg-Management-prd-01"
                            },
                            "location": {
                                "value": "westeurope"
                            }
                        },
                        "groupNames": []
                    },
                    {
                        "policyDefinitionReferenceId": "Require a tag 'severity group monthly' exists and is not empty",
                        "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Require-Tag",
                        "parameters": {
                            "tagName": {
                                "value": "Severity Group Monthly"
                            }
                        },
                        "groupNames": []
                    },
                    {
                        "policyDefinitionReferenceId": "Require a tag 'update allowed' exists and is not empty",
                        "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Require-Tag",
                        "parameters": {
                            "tagName": {
                                "value": "Update allowed"
                            }
                        },
                        "groupNames": []
                    },
                    {
                        "policyDefinitionReferenceId": "Configure patch mode and bypassPlatformSafetyChecksOnUserSchedule setting of windows vm for Azure Update Manager",
                        "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Set-Update-Settings",
                        "parameters": {
                        },
                        "groupNames": []
                    }
                ],
        "policyDefinitionGroups": null
    }
}