{
    "name": "QBY-Tagging-Governance",
    "type": "Microsoft.Authorization/policySetDefinitions",
    "apiVersion": "2021-06-01",
    "scope": null,
    "properties": {
        "policyType": "Custom",
        "description": "Enforce existence of conceptual defined tags and enable inheritance.",
        "displayName": "Tagging Governance",
        "metadata": {
            "version": "2.0.0",
            "category": "Tags"
        },
        "parameters": {},
        "policyDefinitions": ${jsonencode(flatten([[for name, required in inherited_required_tags: [
                    {
                        "policyDefinitionReferenceId": "Inherit_${name}'_from_rg",
                        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/ea3f2387-9b95-492a-a190-fcdc54f7b070",
                        "parameters": {
                            "tagName": {
                                "value": "${name}"
                            }
                        },
                        "groupNames": []
                    },
                    {
                        "policyDefinitionReferenceId": "Inherit_${name}'_from_subscription",
                        "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Deploy-Tags-To-RG",
                        "parameters": {
                            "tagName": {
                                "value": "${name}"
                            }
                        },
                        "groupNames": []
                    }
                ]
            ],
            [for name,required in inherited_required_tags: [
                    {
                        "policyDefinitionReferenceId": "Require_${name}'_on_rg",
                        "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Require-Tag-on-resourceGroup",
                        "parameters": {
                            "tagName": {
                                "value": "${name}"
                            }
                        },
                        "groupNames": []
                    },
                    {
                        "policyDefinitionReferenceId": "Require_${name}'_on_resource",
                        "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Require-Tag",
                        "parameters": {
                            "tagName": {
                                "value": "${name}"
                            }
                        },
                        "groupNames": []
                    }
                ] if required == true
            ]
            ]))
        },
        "policyDefinitionGroups": null
    }
}
