{
    "name": "QBY-Deploy-Require-Tag-Inheritance",
    "type": "Microsoft.Authorization/policySetDefinitions",
    "apiVersion": "2021-06-01",
    "scope": null,
    "properties": {
      "policyType": "Custom",
      "displayName": "Deploy require tags from resource group to resources",
      "description": "Assigns the Microsoft built in policy to inherit a set of tags and not empty tags from a the resource group to resources if missing.",
      "metadata": {
        "version": "1.0.0",
        "category": "Tags"
      },
      "parameters": {},
      "policyDefinitions": ${jsonencode(flatten([for tag_name in tags: [
        {
            "policyDefinitionReferenceId": "Inherit '${tag_name}' tag from resource group to resources if missing",
            "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/ea3f2387-9b95-492a-a190-fcdc54f7b070",
            "parameters": {
                "tagName": {
                    "value": "${tag_name}"
                }
            },
            "groupNames": []
        },
        {
            "policyDefinitionReferenceId": "Require resource groups to have specified non empty tag",
            "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Require-Tag-to-resourceGroups",
            "parameters": {
                "tagName": {
                    "value": "${tag_name}"
                }
            },
            "groupNames": []
        },
        {
            "policyDefinitionReferenceId": "Require resources to have specified non empty tag.",
            "policyDefinitionId": "${root_scope_resource_id}/providers/Microsoft.Authorization/policyDefinitions/QBY-Require-Tag",
            "parameters": {
                "tagName": {
                    "value": "${tag_name}"
                }
            },
            "groupNames": []
        }
      ]]))},
      "policyDefinitionGroups": null
    }
}